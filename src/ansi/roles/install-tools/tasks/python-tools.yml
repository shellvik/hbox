---
- name: "Install python tools in virtualenv"
  become: yes  # Elevate privileges
  apt:
    name: python3-venv
    state: present

- name: "Create a virtual environment"
  become: yes  # Elevate privileges
  shell: python3 -m venv /opt/venv

- name: "Ensure pip is installed in the virtual environment"
  become: yes  # Elevate privileges
  shell: /opt/venv/bin/python -m ensurepip --upgrade

- name: "Upgrade pip to latest"
  become: yes  # Elevate privileges
  shell: /opt/venv/bin/python -m pip install --upgrade pip

- name: "Install pipx in virtualenv"
  become: yes  # Elevate privileges
  shell: /opt/venv/bin/python -m pip install pipx

- name: "Install python tools using pipx"
  become: yes  # Elevate privileges
  pipx:
    name: "{{ item.name }}"
    source: "{{ item.url }}"
    state: latest
  loop:
    - { name: 'impacket', url: 'git+https://github.com/fortra/impacket.git' }
    - { name: 'crackmapexec', url: 'git+https://github.com/Porchetta-Industries/CrackMapExec.git' }
    - { name: 'certipy-ad', url: 'git+https://github.com/ly4k/Certipy.git' }
